from pymetasploit3 import *
from pymetasploit3.msfrpc import *
from pymetasploit3.msfconsole import MsfRpcConsole

# Create the RPC session
client = MsfRpcClient(host='127.0.0.1', port=55552, username='msf', password='OIVBfGV9')

# Launch the scanner module
console = MsfRpcConsole(client)

# Define the scanner module
scanner_module = 'auxiliary/scanner/smb/smb_ms17_010'

# Function to perform the vulnerability scan
def perform_scan(target):
    try:
        # Use the scanner module
        module = client.modules.use('auxiliary', scanner_module)
        module['RHOSTS'] = target

        # Run the scan
        module.execute()

        # Check the scan results
        scan_results = module['SESSIONS']
        if scan_results:
            print(f'Target {target} is vulnerable to DoublePulsar SMB exploit.')
        else:
            print(f'Target {target} is not vulnerable to DoublePulsar SMB exploit.')

    except MsfRpcException as e:
        print(f'Error occurred: {str(e)}')

# Get the target IP from user input
target_ip = input('Enter the IP address of the target: ')

# Perform the vulnerability scan
perform_scan(target_ip)




Enter the IP address of the target: 10.254.6.15
Traceback (most recent call last):
  File "/home/kali/Documents/red_team/red_team.py", line 38, in <module>
    perform_scan(target_ip)
  File "/home/kali/Documents/red_team/red_team.py", line 25, in perform_scan
    scan_results = module['SESSIONS']
                   ~~~~~~^^^^^^^^^^^^
  File "/home/kali/Documents/red_team/lib/python3.11/site-packages/pymetasploit3/msfrpc.py", line 1348, in __getitem__
    raise KeyError("Invalid option '%s'." % item)
KeyError: "Invalid option 'SESSIONS'."
